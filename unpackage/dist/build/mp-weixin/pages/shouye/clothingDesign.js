(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shouye/clothingDesign"],{3789:function(n,t,e){"use strict";e.r(t);var i=e("7283"),s=e.n(i);for(var o in i)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return i[n]}))}(o);t["default"]=s.a},"59de":function(n,t,e){"use strict";var i=e("83c6"),s=e.n(i);s.a},"5df7":function(n,t,e){"use strict";(function(n,t){var i=e("4ea4");e("78aa");i(e("66fd"));var s=i(e("82ed"));n.__webpack_require_UNI_MP_PLUGIN__=e,t(s.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},7283:function(n,t,e){"use strict";(function(n){var i=e("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(e("448a")),o=(i(e("b9d8")),i(e("008c"))),a=i(e("0e8d")),d=i(e("1cdb")),u=(e("7268"),{data:function(){return{designList:[],list:[{id:"A",name:"下载高清大图",downIndex:0,adjustIndex:0,childlist:[{id:"1",pid:"A",name:"图1",isSelect:!1},{id:"2",pid:"A",name:"图2",isSelect:!1},{id:"3",pid:"A",name:"图3",isSelect:!1},{id:"4",pid:"A",name:"图4",isSelect:!1}]},{id:"B",name:"调整设计图",downIndex:0,adjustIndex:0,childlist:[{id:"1",pid:"B",name:"图1",isSelect:!1},{id:"2",pid:"B",name:"图2",isSelect:!1},{id:"3",pid:"B",name:"图3",isSelect:!1},{id:"4",pid:"B",name:"图4",isSelect:!1}]}],toview:"",bottom:{id:"最底部"},insterest:"",insterestCount:"0",designType:"",taskId:null,timer:null,timerCount:0,showLoading:!1,loading:!1,index:0,requestCount:0,transShow:!1,modeClass:"slide-right",transfromClass:{position:"fixed",bottom:0,top:0,left:0,right:0,display:"flex"},curPage:1,pageCount:1,isRequesting:!1,downLoadIndex:null,adjustIndex:null,designInfo:{taskId:null,shopType:null,shopTags:null,brand:null,base64Array:null,downLoadIndex:null,adjustIndex:null,reDesignIndex:null},topId:null,imgMode:"aspectFit"}},onShow:function(t){this.token=n.getStorageSync(this.$config.storage.token),this.token&&this.getLvInfo(),this.$config.design.designInfo&&(this.designInfo=Object.assign({},this.$config.design.designInfo),console.log("设计数据=",this.designInfo),this.startDesign(),this.$config.design.designInfo=null)},onLoad:function(t){var e=this;console.log("options=",t),this.token=n.getStorageSync(this.$config.storage.token),this.token&&this.getHistoryDesignInfo(!1),setTimeout((function(){e.transShow=!0}),2e3)},onUnload:function(){},computed:{userName:function(){var t=n.getStorageSync(this.$config.storage.userInfo);return"@"+t["nickname"]}},methods:{setChildrenId:function(n){var t=this;1===t.curPage?setTimeout((function(){t.$nextTick((function(){if(0!=n.length){var e=n.length-1;t.toview="s"+n[e].id,console.log(t.toview,"首次进入需要滑动到页面最底部")}}))}),1e3):t.$nextTick((function(){t.toview="s"+t.topId,console.log(t.toview,"下拉刷新")}))},scrollTop:function(n){if(!this.isRequesting){this.showLoading=!0,this.topId=this.designList[0].id,console.log("topId1=",this.topId);this.designList.length;var t=Math.floor(this.designList.length/10);this.curPage=(t<1?1:t)+1,console.log("当前页数=",this.designList.length,this.curPage),this.getHistoryDesignInfo(!0)}},startDesign:function(){var n=this.designInfo.taskId?this.designInfo.taskId:null,t=this.designInfo.adjustIndex?this.designInfo.adjustIndex:null,e=this.designInfo.shopType,i=this.designInfo.shopTags,s=this.designInfo.brand,o=this.designInfo.base64Array?this.designInfo.base64Array:null;this.submitTask(t,n,e,i,s,o)},getLvInfo:function(){var n=this;a.default.getInstence(this).then((function(t){console.log("insterest=",t),n.insterest="Plus",n.insterestCount=t.detail.number}))},itemBtnClick:function(n,t,e,i,s){if(n.loading)this.$u.toast("正在生成设计图，请稍后！");else{if(this.insterestCount<=0)return this.$u.toast("您的设计出图次数已不足。"),void this.$nav.to("/pages/shouye/accountEquity");"A"===t.id?n.downIndexs.includes(e.id)||n.downIndexs.push(e.id):"B"===t.id&&(n.adjustIndexs.includes(e.id)||n.adjustIndexs.push(e.id)),e.checked||this.$set(e,"checked",!0);var o=n.id,a=e.id,d=this.getDesignInfoData(n,i,e.id);this.$set(n,"designInfo",d),this.downLoadIndex=null,this.adjustIndex=null,"A"===t.id?(this.designType=this.$config.designType.CHANGE,this.qequestCount=0,this.downLoadIndex=a,this.submitTask(a,o,d.shopType,d.shopTags,d.brand,d.base64Array)):(this.designType=this.$config.designType.CHANGE,this.adjustIndex=a,"Max"!==this.insterest&&"Plus"!==this.insterest?(this.$u.toast("您的账户等级不支持该功能，请升级为PLUS或MAX用户。"),this.$nav.to("/pages/shouye/accountEquity")):(this.$config.design.adjust=!0,this.$config.design.adjustIndex=a,this.$config.design.taskId=o,console.log("designInfo=",d),this.$nav.to("/pages/shouye/designDetails",{designInfo:JSON.stringify(d)},!1)))}},repitDesignClick:function(n,t){if(n.loading)this.$u.toast("正在生成设计图，请稍后！");else{if(this.insterestCount<=0)return this.$u.toast("您的设计出图次数已不足。"),void this.$nav.to("/pages/shouye/accountEquity");n.checked||this.$set(n,"checked",!0),n.reDesign=!0,this.designType=this.$config.designType.CHANGE,this.$config.design.startDesign=!0,this.downLoadIndex=null,this.adjustIndex=null;var e=this.getDesignInfoData(n,t,null);this.$nav.to("/pages/shouye/designDetails",{designInfo:JSON.stringify(e)},!1)}},getDesignInfoData:function(n,t,e){var i={taskId:null,shopType:null,shopTags:null,brand:null,base64Array:null,downLoadIndex:null,adjustIndex:null,reDesignIndex:null};if(i.taskId=n.id,i.reDesignIndex=t,i.adjustIndex=e,n.state){var s=JSON.parse(n.state);i.shopType=s.shopType+"",i.shopTags=s.shopTags,i.brand=s.brand,s.base64Array&&(i.base64Array=Array.isArray(s.base64Array)?s.base64Array[0]:s.base64Array)}return console.log("重组后的designInfo=",i),i},startDesignClick:function(){if(this.designType=this.$config.designType.IMAGINE,this.downLoadIndex=null,this.adjustIndex=null,this.insterestCount<=0)return this.$u.toast("您的设计出图次数已不足。"),void this.$nav.to("/pages/shouye/accountEquity");this.$config.design.startDesign=!0,this.$nav.to("/pages/shouye/selectClass")},toBottomClick:function(){var n=this;this.toview="tobottom",this.showLoading=!1,this.loading=!1,this.$ch.sleep(1e3).then((function(){n.toview="asfkaj"}))},submitTask:function(t,e,i,s,a,d){var u=this;if(console.log("shop_type = ",i),console.log("shop_tags = ",s),console.log("brand = ",a),i&&0!=s.length&&a){this.loading=!0,this.index=t,this.taskId=e;var l={};l["type"]=e?"change":"imagine",l["dimensions"]="LANDSCAPE",l["base64Array"]=Array.isArray(d)?d[0]:d,l["action"]=null,l["index"]=null,l["taskId"]=null,l["state.shopType"]=i,l["state.shopTags"]=s.join(","),l["state.brand"]=a,this.designType===this.$config.designType.CHANGE&&(l["taskId"]=e,this.downLoadIndex?l["action"]="UPSCALE":this.adjustIndex?l["action"]="VARIATION":l["action"]="REROLL","REROLL"!==l["action"]&&(l["index"]=t)),console.log("params=",l),this.$http.get(o.default.subTask,{params:l}).then((function(t){if(console.log("result",t),"1"===t.status){if("已存在"===t.message){n.hideLoading(),u.loading=!1;var e=u.designList.findIndex((function(n){if(n.id==t.taskId)return!0}));return void(e?(u.$u.toast(t.message),u.toview="s"+u.designList[e].id):u.$u.toast("已存在请在历史记录中查看"))}t.taskId?(u.taskId=t.taskId,u.requestCount=0,u.getDesignInfo(t.taskId,!1,!!e),u.$config.design.startDesign=!1,u.$config.design.adjust=!1,u.$config.design.taskId=null,u.$config.design.adjustIndex=null,n.$off("startDesign")):u.$u.toast(t.message)}else n.hideLoading(),u.loading=!1})).catch((function(t){console.log("er",t),n.hideLoading(),u.loading=!1})).finally((function(){}))}},getDesignInfo:function(t,e,i){var s=this;this.$http.get(o.default.designInfo,{params:{taskId:t}}).then((function(e){if(console.log("result",e),"1"===e.status&&e.detail){var i=e.detail[0];if(null==i||"SUCCESS"!==i.status&&"FAILURE"!==i.status?s.timer||(s.timerCount=0,s.start()):"FAILURE"===i.status?(s.$u.toast(i["failReason"]),s.stop()):(s.requestCount>0?s.stop():s.timer||(s.timerCount=0,s.start()),"100%"===i.progress&&s.requestCount++),i.id){s.$set(i,"taskId",t),s.$set(i,"loading","100%"!==i.progress&&"FAILURE"!==i.status&&"SUBMITTED"!==i.status),s.$set(i,"downIndexs",[]),s.$set(i,"adjustIndexs",[]),s.downLoadIndex&&s.$set(i,"downIndex",s.downLoadIndex),s.adjustIndex&&s.$set(i,"adjustIndex",s.adjustIndex);var o=null;s.designList.forEach((function(n,t){n.id===i.id&&(o=t)})),null!==o?s.$set(s.designList,o,i):(s.designList.push(i),setTimeout((function(){n.hideLoading(),s.toBottomClick()}),1e3)),console.log("最终的数据=",s.designList)}}else s.loading=!1,n.hideLoading()})).catch((function(n){console.log("er",n)})).finally((function(){}))},getHistoryDesignInfo:function(t){var e=this;this.isRequesting=!0,this.$http.get(o.default.designInfo+"?pager.sort=_id&pager.order=desc",{params:{taskId:null,curPage:this.curPage}}).then((function(t){if(console.log("result",t),"1"===t.status&&t.detail){e.pageCount=t.pager.pageCount;var i=[],o=t.detail.reverse();o=o.filter((function(n){return null!==n})),o.forEach((function(n,t){if(null!==n&&(e.$set(n,"downIndexs",[]),e.$set(n,"adjustIndexs",[]),"IMAGINE"===n.action||"REROLL"===n.action||"VARIATION"===n.action)){e.$set(n,"reDesign",!1),n.downIndexs=n.subtask.map((function(n){if("UPSCALE"===n.action)return n.index})),n.adjustIndexs=n.subtask.map((function(n){if("VARIATION"===n.action)return n.index}));var i=n.subtask.filter((function(n){return"REROLL"===n.action}));n.checked=i.length>0}})),i=o.concat(e.designList),i=e.elimination(i),e.designList=(0,s.default)(i),console.log("历史数据=",e.designList),e.setChildrenId(i),e.$forceUpdate()}setTimeout((function(){n.hideLoading(),e.showLoading=!1,e.isRequesting=!1}),1e3)})).catch((function(t){console.log("er",t),n.hideLoading(),e.showLoading=!1})).finally((function(){n.stopPullDownRefresh()}))},elimination:function(n){var t=new Map;return n.filter((function(n){return!t.has(n.id)&&t.set(n.id,1)}))},getDesignTitle:function(n){if("100%"===n.progress){if(n.state){var t=JSON.parse(n.state);"UPSCALE"===n.action?n.downIndex=t.index:"VARIATION"===n.action&&(n.adjustIndex=t.index)}return n.downIndex?"已生成设计图".concat(n.seed?n.seed:"","图").concat(n.downIndex?n.downIndex:1,"的高清大图  "):n.adjustIndex?"已生成设计图".concat(n.seed?n.seed:"","图").concat(n.adjustIndex?n.adjustIndex:1,"的调整设计图  "):"已生成设计图".concat(n.seed?n.seed:"")}return"正在生成设计图，请稍等（".concat(n.progress?n.progress:"0%",")")},start:function(){var n=this;n.timer=setInterval((function(){n.timerCount>=50?n.stop():(n.timerCount++,n.getDesignInfo(n.taskId,!1))}),2e3)},stop:function(){n.hideLoading(),this.loading=!1;this.timer&&(clearInterval(this.timer),this.timer=null)},getTime:function(n){return n?(0,d.default)(n).format("YYYY･MM･DD HH:mm"):""},onTap:function(){var n=this;this.modeClass="fade",this.transShow=!1,setTimeout((function(){n.startDesignClick()}),800)},clickImg:function(t){console.log("点击的下标=",t.imageUrl);var e=this.$config.imgUrl+t.imageUrl;n.previewImage({urls:[e],current:"",success:function(n){},fail:function(n){},complete:function(n){}})}}});t.default=u}).call(this,e("543d")["default"])},"7a4f":function(n,t,e){"use strict";e.d(t,"b",(function(){return s})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){return i}));var i={"u-Image":function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u--image/u--image")]).then(e.bind(null,"1b3d"))},uLoadingIcon:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-loading-icon/u-loading-icon")]).then(e.bind(null,"5e6d"))},uGap:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-gap/u-gap")]).then(e.bind(null,"fcf4"))},uTransition:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-transition/u-transition")]).then(e.bind(null,"8a32"))},uOverlay:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(e.bind(null,"f20b"))}},s=function(){var n=this,t=n.$createElement,e=(n._self._c,n.__map(n.designList,(function(t,e){var i=n.__get_orig(t),s=n.getTime(t.submitTime),o=n.getDesignTitle(t),a=n.__map(n.list,(function(e,i){var s=n.__get_orig(e),o=n.__map(e.childlist,(function(i,s){var o=n.__get_orig(i),a="A"===e.id?t.downIndexs&&t.downIndexs.includes(i.id):null,d="B"===e.id?t.adjustIndexs&&t.adjustIndexs.includes(i.id):null;return{$orig:o,g0:a,g1:d}}));return{$orig:s,l0:o}}));return{$orig:i,m0:s,m1:o,l1:a}})));n.$mp.data=Object.assign({},{$root:{l2:e}})},o=[]},"82ed":function(n,t,e){"use strict";e.r(t);var i=e("7a4f"),s=e("3789");for(var o in s)["default"].indexOf(o)<0&&function(n){e.d(t,n,(function(){return s[n]}))}(o);e("59de");var a=e("f0c5"),d=Object(a["a"])(s["default"],i["b"],i["c"],!1,null,"371e0369",null,!1,i["a"],void 0);t["default"]=d.exports},"83c6":function(n,t,e){}},[["5df7","common/runtime","common/vendor"]]]);