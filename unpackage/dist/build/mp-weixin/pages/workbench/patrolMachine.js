(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/workbench/patrolMachine"],{"2f76":function(t,e,n){},"4b5f":function(t,e,n){"use strict";(function(t){var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("dcfe")),o=i(n("1cdb")),c={data:function(){return{list:[{title:"派工单号",name:"dispatchNo",text:""},{title:"派单项次",name:"dispatchPrior",text:""},{title:"产品名称",name:"itemName",text:""},{title:"产品编码",name:"itemNo",text:""},{title:"本班生产数",name:"prodQty",text:""},{title:"本班良品数",name:"goodQty",text:""},{title:"本班巡机数",name:"patrolQty",text:""},{title:"本班打磨数",name:"polishQty",text:""}],cardList:[],metarialList:[{name:"巡机",select:!1},{name:"打磨",select:!1}],machineNo:null,target:[],childList:[],inputValue:null,detailData:{},startData:[],targetIdx:0,btnLoading:!1}},onLoad:function(t){var e=this;this.$store.state.permission.forEach((function(t){"RGB_Patro"!==t.tag&&"RGB_Polish"!==t.tag||e.target.push(t)})),console.log("传过来的数据=",JSON.parse(t.detail));var n=JSON.parse(t.detail);null!=n&&(this.machineNo=n.machineNo,this.cardOrderInfo(n.id,n.tag),this.cardrecordList())},computed:{getChTitle:function(){return this.cardList.length>0?"子件":"选择功能"},getBtnTitle:function(){return this.cardList.length>0?"保 存":"开 始"}},methods:{change:function(t){console.log("change",t),this.cardList[t].num=this.inputValue},input:function(t){console.log("input",t),this.inputValue=t},confirmClick:function(){if(console.log("提交的值是",this.cardList),this.cardList[0]){if(!this.cardList[0].num>0)return void this.$ch.toast("请输入数量");this.savesCard()}else this.startEvent()},itemClick:function(t){console.log("item",t),this.targetIdx=t,this.metarialList.forEach((function(t){t.select=!1})),this.metarialList[t].select=!0,console.log("最后的数据=",this.metarialList)},cardOrderInfo:function(e,n){var i=this;t.$u.http.get(a.default.cardOrderInfo+"id="+e+"&cardType="+n).then((function(t){console.log("result",t),200===t.code&&(i.detailData=t.data,i.detailData&&i.list.forEach((function(t){t.text=i.detailData[t.name],"patrolQty"!==t.name&&"polishQty"!==t.name&&"prodQty"!==t.name&&"goodQty"!==t.name||(t.text=i.detailData.params[t.name])})))})).catch((function(t){console.log("er",t)})).finally((function(){i.isGet=!1}))},cardrecordList:function(){var t=this;this.$http.post(a.default.cardrecordList,{machineNo:this.machineNo,params:{cardTypeQt:"in",cardTypes:this.target.map((function(t){return t.id})),isNullColumns:["end_time"]}}).then((function(e){200===e.code&&(t.cardList=e.data,t.$forceUpdate(),console.log("cardList=",t.cardList))}))},startEvent:function(){var e=this,n=this.$ch.deepClone(this.detailData);delete n.id,n["cardType"]=this.target[this.targetIdx].id,n["startTime"]=(0,o.default)(new Date).format("YYYY-MM-DD HH:mm:ss"),n["cardTypeTag"]=this.target[this.targetIdx].tag,this.btnLoading=!0,this.$http.post(this.$api.base.startEvent,n).then((function(n){200===n.code&&(e.startData=n.data,e.cardrecordList(),t.$emit("returnCard","start"))})).finally((function(){e.btnLoading=!1}))},savesCard:function(){var e=this,n=[];n.push({checkQty:this.cardList[0].num,itemName:this.detailData.itemName,itemNo:this.detailData.itemNo,mo:this.detailData.mo}),this.detailData.params.childrenList.length>0&&this.detailData.params.childrenList.forEach((function(t){n.push({checkQty:t.num,itemName:t.itemName,itemNo:t.itemNo,mo:t.mo})})),this.btnLoading=!0,this.$http.post("".concat(this.$api.base.endEvent).concat(this.cardList[0].id),{endTime:(0,o.default)(new Date).format("YYYY-MM-DD HH:mm:ss"),extList:n}).then((function(n){e.$ch.toast(n.msg),t.$emit("returnCard","success"),e.$ch.sleep(1e3).then((function(){e.$nav.back()}))})).finally((function(){e.btnLoading=!1}))}}};e.default=c}).call(this,n("543d")["default"])},"6cc4":function(t,e,n){"use strict";n.r(e);var i=n("4b5f"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},"78ea":function(t,e,n){"use strict";n.r(e);var i=n("fa2e"),a=n("6cc4");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("c441");var c=n("f0c5"),s=Object(c["a"])(a["default"],i["b"],i["c"],!1,null,"32973db5",null,!1,i["a"],void 0);e["default"]=s.exports},"7a50":function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("78aa");i(n("66fd"));var a=i(n("78ea"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},c441:function(t,e,n){"use strict";var i=n("2f76"),a=n.n(i);a.a},fa2e:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={uCell:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(n.bind(null,"09bb"))},chTitle:function(){return Promise.all([n.e("common/vendor"),n.e("components/ch-title/ch-title")]).then(n.bind(null,"f9b2"))},"u-Input":function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u--input/u--input")]).then(n.bind(null,"1e80"))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"8d70"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"4c6d"))}},a=function(){var t=this.$createElement,e=(this._self._c,this.cardList.length);this.$mp.data=Object.assign({},{$root:{g0:e}})},o=[]}},[["7a50","common/runtime","common/vendor"]]]);